{% extends "base.html" %}

{% block content %}

<main id='map' style='width: 100%; height: 600px;'></main>
<footer>
  <div>
    <span class="sign very-good"></span>Velmi doporučuji
  </div>
  <div>
    <span class="sign pretty-good"></span>Doporučuji
  </div>
  <div>
    <span class="sign good"></span>Not great, not terrible
  </div>
  <div>
    <span class="sign not-been-yet"></span>Nevyzkoušel jsem (zatím)
  </div>
</footer>

<script>
  mapboxgl.accessToken = 'pk.eyJ1Ijoicm9zZW5iZXJnbSIsImEiOiJjamtzYjlnYnkzcjF3M3Fwanc4Nmdmd3IxIn0.j29iER1BDiwOCUCwk4aA9A';

  const map = new mapboxgl.Map({
    container: 'map',
    // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [14.4378, 50.0755], // starting center in [lng, lat]
    zoom: 10 // starting zoom
  });

  map.addControl(
    new mapboxgl.GeolocateControl({
      positionOptions: {
        enableHighAccuracy: true
      },
      // When active the map will receive updates to the device's location as it changes.
      trackUserLocation: true,
      // Draw an arrow next to the location dot to indicate which direction the device is heading.
      showUserHeading: true
    })
  );

  const data = {{ places | tojson | safe }};

  for (const point of data) {
    const popup = new mapboxgl.Popup({ offset: 25 }).setHTML(
      `<h3>${point.name}</h3>
      <p>${point.description}</p>
      <p>${point.address}</p>
      <a target="_blank" href="https://maps.google.com?q=${point.name}">Otevřít v Mapách Google</a>
      `
    ).addClassName('popup');

    new mapboxgl.Marker({
      color: point.color
    }).setLngLat(point.coordinates).setPopup(popup).addTo(map);
  }

</script>


{% endblock content %}